<form class="row g-3" [formGroup]="form">
  <h1>Registrar Lectura</h1>

  <!-- Cliente -->
  <div class="col-md-6">
    <label class="form-label">Cliente</label>
    <select class="form-select" formControlName="id_cliente">
      <option value="">Seleccione un cliente</option>
      @for (c of clientes; track c.id_cliente) {
        <option [value]="c.id_cliente">{{ c.nombre_razon }} — {{ c.rut }}</option>
      }
    </select>
  </div>

  <!-- Medidor (se llena automáticamente según cliente) -->
  <div class="col-md-6">
    <label class="form-label">
      Medidor
      <span *ngIf="cargandoMedidores" class="text-muted">(cargando…)</span>
    </label>
    <select class="form-select" formControlName="id_medidor" [disabled]="!medidores.length">
      <option value="">{{ medidores.length ? 'Seleccione un medidor' : 'Sin medidores para este cliente' }}</option>
      @for (m of medidores; track m.id_medidor) {
        <option [value]="m.id_medidor">{{ m.codigo_medidor || ('Medidor ' + m.id_medidor) }}</option>
      }
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">Año</label>
    <input type="number" class="form-control" formControlName="anio">
  </div>

  <div class="col-md-3">
    <label class="form-label">Mes</label>
    <input type="number" class="form-control" formControlName="mes" min="1" max="12">
  </div>

  <div class="col-md-6">
    <label class="form-label">Lectura (kWh)</label>
    <input type="number" class="form-control" formControlName="lectura_kwh" min="0">
  </div>

  <div class="col-12">
    <label class="form-label">Observación</label>
    <textarea class="form-control" formControlName="observacion" rows="2" placeholder="Opcional"></textarea>
  </div>

  <div class="col-12">
    <button type="button" class="btn btn-primary" (click)="guardar()">Guardar Lectura</button>
  </div>
</form>
